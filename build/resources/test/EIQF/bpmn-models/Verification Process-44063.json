{"bounds":{"lowerRight":{"x":1616.0,"y":1077.0756684525504},"upperLeft":{"x":0.0,"y":0.0}},"resourceId":"canvas","stencil":{"id":"BPMNDiagram"},"stencilset":{"namespace":"http://b3mn.org/stencilset/bpmn2.0#","url":"../editor/stencilsets/bpmn2.0/bpmn2.0.json"},"properties":{"process_id":"Process_VOE","name":"VOE","executionlisteners":{"executionListeners":[]},"eventlisteners":{"eventListeners":[]},"signaldefinitions":[{"id":"applicantConsentReceived","name":"Applicant Consent Received","scope":"processInstance"}],"messagedefinitions":[],"executionvariables":[{"variableName":"requestid","variableType":"string"},{"variableName":"istwncandidate","variableType":"boolean"},{"variableName":"hasmoreverifications","variableType":"boolean"},{"variableName":"requestjson","variableType":"string"},{"variableName":"applicantname","variableType":"string"},{"variableName":"hostname","variableType":"string"},{"variableName":"authenticatedUserId","variableType":"string"},{"variableName":"tentantId","variableType":"string"},{"variableName":"loannumber","variableType":"string"},{"variableName":"containsUnmatchedTwn","variableType":"string"},{"variableName":"apsHostName","variableType":"string"},{"variableName":"containsReverification","variableType":"string"},{"variableName":"applicantsNeedManualMatch","variableType":"string"}],"process_namespace":"http://www.activiti.org/processdef"},"childShapes":[{"bounds":{"lowerRight":{"x":992.2499999999999,"y":665.9999999999999},"upperLeft":{"x":61.0,"y":130.0}},"resourceId":"sid-8F0B75AC-010E-425F-8B1B-9F43E816B209","childShapes":[{"bounds":{"lowerRight":{"x":931.2499999999999,"y":178.15133690510118},"upperLeft":{"x":30.0,"y":0.0}},"resourceId":"sid-58C7CF17-06BC-4AA6-AF52-F754187A4616","childShapes":[{"bounds":{"lowerRight":{"x":534.0,"y":130.0},"upperLeft":{"x":434.0,"y":50.0}},"resourceId":"sid-C75D17AD-74EB-4556-8174-B122AB7374F0","childShapes":[],"stencil":{"id":"CallActivity"},"properties":{"overrideid":"sid-C75D17AD-74EB-4556-8174-B122AB7374F0","name":"Verify Applicant and Employments","callactivitycalledelement":"ConfirmBorrowerAuthorization","callactivityinparameters":{"inParameters":[{"source":"initiator","target":"initiator","sourceExpression":null},{"source":"applicant","target":"applicant","sourceExpression":null},{"source":"hostname","target":"hostname","sourceExpression":null},{"source":"authenticatedUserId","target":"authenticatedUserId","sourceExpression":null},{"source":"tenantId","target":"tenantId","sourceExpression":null},{"source":"requestid","target":"requestid","sourceExpression":null},{"source":"containsReverification","target":"containsReverification","sourceExpression":null},{"source":"customerName","target":"customerName","sourceExpression":null},{"source":"requesterEmail","target":"requesterEmail","sourceExpression":null},{"source":"requester","target":"requester","sourceExpression":null},{"source":"dateCreated","target":"dateCreated","sourceExpression":null},{"source":"losClientName","target":"losClientName","sourceExpression":null}]},"callactivityoutparameters":{"outParameters":[]},"executionlisteners":{"executionListeners":[]},"isforcompensation":false,"asynchronousdefinition":false,"exclusivedefinition":false,"multiinstance_type":"Parallel","multiinstance_collection":"applicants","multiinstance_variable":"applicant"},"outgoing":[{"resourceId":"sid-E22CECFD-7EE9-4344-AF37-22B79D7A4649"}]},{"bounds":{"lowerRight":{"x":627.0,"y":104.0},"upperLeft":{"x":599.0,"y":76.0}},"resourceId":"sid-99929A6E-65FB-4002-B233-73AEE8316400","childShapes":[],"stencil":{"id":"EndNoneEvent"},"properties":{"overrideid":"sid-99929A6E-65FB-4002-B233-73AEE8316400","executionlisteners":{"executionListeners":[]},"asynchronousdefinition":false,"exclusivedefinition":false},"outgoing":[]},{"bounds":{"lowerRight":{"x":354.0,"y":145.0},"upperLeft":{"x":254.0,"y":65.0}},"resourceId":"sid-D1D48325-8FC9-4FD4-A836-47D4936AED0A","childShapes":[],"stencil":{"id":"CallActivity"},"properties":{"overrideid":"sid-D1D48325-8FC9-4FD4-A836-47D4936AED0A","name":"Match Employments to TWN Employers","callactivitycalledelement":"ResolveUnmatchedTWNEmployers","callactivityinparameters":{"inParameters":[{"source":"initiator","target":"initiator","sourceExpression":null},{"source":"unmatchedTWNEmployment","target":"unmatchedTWNEmployment","sourceExpression":null},{"source":"requestid","target":"requestid","sourceExpression":null},{"source":"loannumber","target":"loannumber","sourceExpression":null},{"source":"customerName","target":"customerName","sourceExpression":null},{"source":"requester","target":"requester","sourceExpression":null},{"source":"requesterEmail","target":"requesterEmail","sourceExpression":null},{"source":"applicantsNeedManualMatch","target":"applicantsNeedManualMatch","sourceExpression":null},{"source":"dateCreated","target":"dateCreated","sourceExpression":null}]},"callactivityoutparameters":{"outParameters":[]},"executionlisteners":{"executionListeners":[{"event":"end","className":"org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener","fields":[{"name":"language","stringValue":"javascript"},{"name":"script","stringValue":"execution.setVariable(\"containsUnmatchedTwn\", \"\");"}]}]},"isforcompensation":false,"asynchronousdefinition":false,"exclusivedefinition":false,"multiinstance_type":"Parallel","multiinstance_collection":"unmatchedTWNEmployments","multiinstance_variable":"unmatchedTWNEmployment"},"outgoing":[{"resourceId":"sid-D5362942-355E-4A50-B32B-CFB723ED0AF7"}]},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-E22CECFD-7EE9-4344-AF37-22B79D7A4649","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":50.0,"y":40.0},{"x":14.0,"y":14.0}],"outgoing":[{"resourceId":"sid-99929A6E-65FB-4002-B233-73AEE8316400"}],"target":{"resourceId":"sid-99929A6E-65FB-4002-B233-73AEE8316400"},"properties":{"overrideid":"sid-E22CECFD-7EE9-4344-AF37-22B79D7A4649","executionlisteners":{"executionListeners":[]}}},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-D5362942-355E-4A50-B32B-CFB723ED0AF7","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":50.0,"y":40.0},{"x":245.0,"y":235.0},{"x":50.0,"y":40.0}],"outgoing":[{"resourceId":"sid-46D6674E-FDA3-4C9F-A3BF-57521473FA56"}],"target":{"resourceId":"sid-46D6674E-FDA3-4C9F-A3BF-57521473FA56"},"properties":{"overrideid":"sid-D5362942-355E-4A50-B32B-CFB723ED0AF7","executionlisteners":{"executionListeners":[]}}}],"stencil":{"id":"Lane"},"properties":{"overrideid":"sid-58C7CF17-06BC-4AA6-AF52-F754187A4616","name":"Processor"},"outgoing":[]},{"bounds":{"lowerRight":{"x":931.2499999999999,"y":535.9999999999999},"upperLeft":{"x":30.0,"y":178.15133690510118}},"resourceId":"sid-95069658-44E4-4F7C-A68D-C0E58DAEF100","childShapes":[{"bounds":{"lowerRight":{"x":204.0,"y":218.92433154744936},"upperLeft":{"x":104.0,"y":138.92433154744936}},"resourceId":"sid-EF69B306-F876-4B98-8527-701A1DBF8B18","childShapes":[],"stencil":{"id":"SubProcessCollapsed"},"properties":{"overrideid":"sid-EF69B306-F876-4B98-8527-701A1DBF8B18","name":"Retrieve Request","subprocessreference":{"id":"44051","name":"Get Request Details"},"executionlisteners":{"executionListeners":[]},"isforcompensation":false,"asynchronousdefinition":false,"exclusivedefinition":false},"outgoing":[{"resourceId":"sid-959B89A6-4E11-4D69-A955-3EB7CE70B2A5"}]},{"bounds":{"lowerRight":{"x":59.0,"y":193.92433154744936},"upperLeft":{"x":29.0,"y":163.92433154744936}},"resourceId":"startEvent1","childShapes":[],"stencil":{"id":"StartNoneEvent"},"properties":{"overrideid":"startEvent1","name":"Start","formreference":{"id":44047,"name":"Start Verification - VOE"},"executionlisteners":{"executionListeners":[]},"asynchronousdefinition":false,"exclusivedefinition":false},"outgoing":[{"resourceId":"sid-74A533CC-D942-44D9-89C0-8426523649E2"}]},{"bounds":{"lowerRight":{"x":534.0,"y":218.92433154744936},"upperLeft":{"x":434.0,"y":138.92433154744936}},"resourceId":"sid-490E3A43-E2F5-4988-B4FC-F16301F2BC1C","childShapes":[],"stencil":{"id":"ScriptTask"},"properties":{"overrideid":"generateVerificationList","name":"Generate List of  Applicant Verifications","scriptformat":"javascript","scripttext":"var request = JSON.parse(requestjson);\n\nvar originalApps = request.applicants;\nvar appCount = originalApps.length;\n\n//Prep for the variable that will be used in the execution context\nvar ArrayList = Java.type(\"java.util.ArrayList\");\nvar appList = new ArrayList();\n\n//Generate an updated list of applicants containing only applicants/employments that are not complete.\nfor (var i = 0; i < appCount; i++ ){\n    var newEmps = [];\n    var thisApp = originalApps[i];\n    //Get all the employments. We need to see if all are completed.\n    for (var j = 0; j < thisApp.employments.length; j++){\n        var thisEmp = thisApp.employments[j];\n        if (containsReverification == 'true') {\n            if (thisEmp.verificationMethod !== 'TWN' && thisEmp.originalEmploymentId != null && thisEmp.voeState === 'SUBMITTED'){\n                thisEmp.requestId = request.productRequestRefId\n                thisEmp.loanNumber = request.loanNumber\n                newEmps.push(thisEmp);\n            }\n        } else {\n            if (thisEmp.voeState !== 'COMPLETED' && thisEmp.voeState !== 'CANCELLED') {\n                thisEmp.requestId = request.productRequestRefId\n                thisEmp.loanNumber = request.loanNumber\n                newEmps.push(thisEmp);\n            }\n        }\n    }\n    //Only add the applicant if there are incomplete employments for them\n    if (newEmps !== null && newEmps.length > 0) {\n            thisApp.employments = newEmps;\n            thisApp.requestId = request.productRequestRefId\n            thisApp.loanNumber = request.loanNumber\n            appList.add(JSON.stringify(thisApp));\n    }\n}\n\nexecution.setVariable(\"applicants\", appList);\n\nprint(\"APPLICANTS.....\");\nprint(appList);\n\nexecution.setVariable(\"authenticatedUserId\",\"1\");\nexecution.setVariable(\"tenantId\",\"tenant_1\");\nexecution.setVariable(\"dateCreated\", request.dateCreated);\nexecution.setVariable(\"customerName\", request.customerName || \"\");\nexecution.setVariable(\"losClientName\", request.losClientName || \"\");\nexecution.setVariable(\"requester\", request.requester.firstName + '  ' + request.requester.lastName);\nexecution.setVariable(\"requesterEmail\", request.requester.email);\n","executionlisteners":{"executionListeners":[]},"isforcompensation":false,"asynchronousdefinition":false,"exclusivedefinition":false},"outgoing":[{"resourceId":"sid-7F561BB5-59C3-4181-B66E-1DFA2AFA1454"}]},{"bounds":{"lowerRight":{"x":354.0,"y":86.84866309489882},"upperLeft":{"x":254.0,"y":6.848663094898825}},"resourceId":"sid-4FF109CD-E8C7-4169-9304-D63EB9269F31","childShapes":[],"stencil":{"id":"ScriptTask"},"properties":{"overrideid":"sid-4FF109CD-E8C7-4169-9304-D63EB9269F31","name":"Generate List of Unmatched Employments","scriptformat":"javascript","scripttext":"var request = JSON.parse(requestjson);\n\nvar apps = request.applicants;\nvar appCount = apps.length;\n\n//Prep for the variable that will be used in the execution context\nvar ArrayList = Java.type(\"java.util.ArrayList\");\nvar unmatchedEmps = new ArrayList();\n\n//Generate a list of non-TWN employments for matching\nfor (var i = 0; i < appCount; i++ ){\n    var thisApp = apps[i];\n    //Get all the employments. We need to see if all are completed.\n    for (var j = 0; j < thisApp.employments.length; j++){\n        var thisEmp = thisApp.employments[j];\n        if (thisEmp.voeState === 'SUBMITTED'){\n            thisEmp.applicantRefId = thisApp.applicantRefId;\n            unmatchedEmps.add(JSON.stringify(thisEmp));\n        }\n    }\n}\n\nexecution.setVariable(\"unmatchedTWNEmployments\", unmatchedEmps);\nprint('*******************' + request.dateCreated);\n\nexecution.setVariable(\"dateCreated\", request.dateCreated || \"\");\nexecution.setVariable(\"customerName\", request.customerName || \"\");\nexecution.setVariable(\"loannumber\", request.loanNumber || \"\");\nexecution.setVariable(\"requester\", request.requester.firstName + '  ' + request.requester.lastName);\nexecution.setVariable(\"requesterEmail\", request.requester.email);\nexecution.setVariable(\"applicantsNeedManualMatch\", containsUnmatchedTwn);","executionlisteners":{"executionListeners":[]},"isforcompensation":false,"asynchronousdefinition":false,"exclusivedefinition":false},"outgoing":[{"resourceId":"sid-5CE75E99-148C-4717-9616-7F12AAB75455"}]},{"bounds":{"lowerRight":{"x":324.0,"y":198.92433154744936},"upperLeft":{"x":284.0,"y":158.92433154744936}},"resourceId":"sid-4D289F6F-0BAB-48E5-9B29-3939D3DEAEDC","childShapes":[],"stencil":{"id":"ExclusiveGateway"},"properties":{"overrideid":"unmatchedTwn","name":"Unmatched TWN?","executionlisteners":{"executionListeners":[]},"asynchronousdefinition":false,"exclusivedefinition":false},"outgoing":[{"resourceId":"sid-E4F702E1-9615-4737-B3DD-054C135B3D37"},{"resourceId":"sid-3D6500F6-085D-46F0-A850-B0F3942C23E7"}]},{"bounds":{"lowerRight":{"x":204.0,"y":91.04866309489887},"upperLeft":{"x":104.0,"y":11.04866309489887}},"resourceId":"sid-46D6674E-FDA3-4C9F-A3BF-57521473FA56","childShapes":[],"stencil":{"id":"RestCallTask"},"properties":{"overrideid":"sid-46D6674E-FDA3-4C9F-A3BF-57521473FA56","name":"Complete Unmatched TWN Update","restcalltask_endpoint":{"rest_url":"api/product-requests/${requestid}/finalizetwnrequest","http_method":"PUT","endpoint_config":{"id":"1","name":"MUS Services"}},"restcalltask_request_mapping":[],"restcalltask_response_mapping":[],"restcalltask_request_headers":[],"servicetaskfields":{"fields":[{"name":"baseEndpoint","stringValue":"1"},{"name":"baseEndpointName","stringValue":"MUS Services"},{"name":"restUrl","stringValue":"api/product-requests/${requestid}/finalizetwnrequest"},{"name":"httpMethod","stringValue":"PUT"}]},"executionlisteners":{"executionListeners":[]},"isforcompensation":false,"asynchronousdefinition":true,"exclusivedefinition":true},"outgoing":[{"resourceId":"sid-FD9134DA-D479-44A1-AFDF-6E8E7686E48B"},{"resourceId":"sid-F1650B42-8A85-4E29-89B0-C5D576A902FB"}]},{"bounds":{"lowerRight":{"x":219.20568567459554,"y":81.5532006912473},"upperLeft":{"x":189.20568567459554,"y":51.5532006912473}},"resourceId":"sid-F1650B42-8A85-4E29-89B0-C5D576A902FB","childShapes":[],"stencil":{"id":"BoundaryErrorEvent"},"dockers":[{"x":85.20568567459554,"y":40.50453759634843}],"properties":{"overrideid":"sid-F1650B42-8A85-4E29-89B0-C5D576A902FB","cancelactivity":true,"executionlisteners":{"executionListeners":[]},"asynchronousdefinition":false,"exclusivedefinition":false},"outgoing":[{"resourceId":"sid-C0A36363-5EEB-48BB-9A49-4DFD7DD41F76"}]},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-7F561BB5-59C3-4181-B66E-1DFA2AFA1454","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":50.0,"y":40.0},{"x":50.0,"y":40.0}],"outgoing":[{"resourceId":"sid-C75D17AD-74EB-4556-8174-B122AB7374F0"}],"target":{"resourceId":"sid-C75D17AD-74EB-4556-8174-B122AB7374F0"},"properties":{"overrideid":"sid-7F561BB5-59C3-4181-B66E-1DFA2AFA1454","executionlisteners":{"executionListeners":[]}}},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-959B89A6-4E11-4D69-A955-3EB7CE70B2A5","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":50.0,"y":40.0},{"x":20.0,"y":20.0}],"outgoing":[{"resourceId":"sid-4D289F6F-0BAB-48E5-9B29-3939D3DEAEDC"}],"target":{"resourceId":"sid-4D289F6F-0BAB-48E5-9B29-3939D3DEAEDC"},"properties":{"overrideid":"sid-959B89A6-4E11-4D69-A955-3EB7CE70B2A5","executionlisteners":{"executionListeners":[]}}},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-74A533CC-D942-44D9-89C0-8426523649E2","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":15.0,"y":15.0},{"x":50.0,"y":40.0}],"outgoing":[{"resourceId":"sid-EF69B306-F876-4B98-8527-701A1DBF8B18"}],"target":{"resourceId":"sid-EF69B306-F876-4B98-8527-701A1DBF8B18"},"properties":{"overrideid":"sid-74A533CC-D942-44D9-89C0-8426523649E2","executionlisteners":{"executionListeners":[]}}},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-E4F702E1-9615-4737-B3DD-054C135B3D37","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":20.0,"y":20.0},{"x":50.0,"y":40.0}],"outgoing":[{"resourceId":"sid-490E3A43-E2F5-4988-B4FC-F16301F2BC1C"}],"target":{"resourceId":"sid-490E3A43-E2F5-4988-B4FC-F16301F2BC1C"},"properties":{"overrideid":"no","name":"No","executionlisteners":{"executionListeners":[]},"defaultflow":true}},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-5CE75E99-148C-4717-9616-7F12AAB75455","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":50.0,"y":40.0},{"x":50.0,"y":40.0}],"outgoing":[{"resourceId":"sid-D1D48325-8FC9-4FD4-A836-47D4936AED0A"}],"target":{"resourceId":"sid-D1D48325-8FC9-4FD4-A836-47D4936AED0A"},"properties":{"overrideid":"sid-5CE75E99-148C-4717-9616-7F12AAB75455","executionlisteners":{"executionListeners":[]}}},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-FD9134DA-D479-44A1-AFDF-6E8E7686E48B","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":50.0,"y":40.0},{"x":50.0,"y":40.0}],"outgoing":[{"resourceId":"sid-EF69B306-F876-4B98-8527-701A1DBF8B18"}],"target":{"resourceId":"sid-EF69B306-F876-4B98-8527-701A1DBF8B18"},"properties":{"overrideid":"sid-FD9134DA-D479-44A1-AFDF-6E8E7686E48B","executionlisteners":{"executionListeners":[]}}},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-C0A36363-5EEB-48BB-9A49-4DFD7DD41F76","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":15.0,"y":15.0},{"x":50.0,"y":40.0}],"outgoing":[{"resourceId":"sid-EF69B306-F876-4B98-8527-701A1DBF8B18"}],"target":{"resourceId":"sid-EF69B306-F876-4B98-8527-701A1DBF8B18"},"properties":{"overrideid":"sid-C0A36363-5EEB-48BB-9A49-4DFD7DD41F76","executionlisteners":{"executionListeners":[]}}},{"bounds":{"lowerRight":{"x":172.0,"y":212.0},"upperLeft":{"x":128.0,"y":212.0}},"resourceId":"sid-3D6500F6-085D-46F0-A850-B0F3942C23E7","childShapes":[],"stencil":{"id":"SequenceFlow"},"dockers":[{"x":20.0,"y":20.0},{"x":50.0,"y":40.0}],"outgoing":[{"resourceId":"sid-4FF109CD-E8C7-4169-9304-D63EB9269F31"}],"target":{"resourceId":"sid-4FF109CD-E8C7-4169-9304-D63EB9269F31"},"properties":{"overrideid":"sid-3D6500F6-085D-46F0-A850-B0F3942C23E7","executionlisteners":{"executionListeners":[]},"conditionsequenceflow":{"expression":{"index":"0","leftRestResponseId":"containsUnmatchedTwn","rightValue":"true","operator":"notEmpty","type":"variables"}}}}],"stencil":{"id":"Lane"},"properties":{"overrideid":"sid-95069658-44E4-4F7C-A68D-C0E58DAEF100","name":"System"},"outgoing":[]}],"stencil":{"id":"Pool"},"properties":{"overrideid":"VOE","name":"VOE"},"outgoing":[]}]}